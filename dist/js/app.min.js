function googleError(){window.alert("Google Maps request error")}var map,style=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],infoWindow=new google.maps.InfoWindow({content:'<div><h4 id="place-name"></h4><p id="place-address"></p><p id="yelp"></p></div>'}),ViewModel=function(){"use strict";var e=this;e.placeList=ko.observableArray([]),e.filteredPlaceList=ko.observableArray([]),e.initialize=function(){var e=document.getElementById("google-map"),t=new google.maps.LatLng(38.6766764,-9.184167),a={center:t,zoom:13,styles:style,disableDefaultUI:!1};map=new google.maps.Map(e,a)},e.buildPlaceLocations=function(){placeLocations.forEach(function(t){e.placeList.push(new Place(t))})},e.setPlaceClickFunctions=function(){e.placeList().forEach(function(t){google.maps.event.addListener(t.marker(),"click",function(){e.placeClick(t)})})},e.placeClick=function(t){var a='<div><h4 id="place-name">'+t.name()+'</h4><h5 id="place-address">'+t.address()+'</h5><h6 id="place-type">'+t.type()+'</h6><p id="text">Rating on <a id="yelp-url">yelp</a>: <img id="yelp"></p></div><br><img class="images" src= http://maps.googleapis.com/maps/api/streetview?size=200x100&location='+t.lat()+","+t.lng()+">";infoWindow.setContent(a),e.getYelpData(t),map.panTo(new google.maps.LatLng(t.lat(),t.lng())),infoWindow.open(map,t.marker()),e.toggleBounce(t)},e.toggleBounce=function(e){e.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker().setAnimation(null)},1500)},e.filterPlaces=function(){e.filteredPlaceList([]);for(var t=$("#search-str").val().toLowerCase(),a=e.placeList().length,l=0;l<a;l++){var o=e.placeList()[l].name().toLowerCase(),r=e.placeList()[l].type().toLowerCase();o.indexOf(t)>-1||r.indexOf(t)>-1?(e.filteredPlaceList.push(e.placeList()[l]),e.placeList()[l].marker().setMap(map)):e.placeList()[l].marker().setMap(null)}},e.getYelpData=function(e){var t="GET",a="https://api.yelp.com/v2/search/",l=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=0;l<e;l++)t+=a.charAt(Math.floor(Math.random()*a.length));return t},o={oauth_consumer_key:"S46AQ1iwQtvxw_D1wQLHZA",oauth_token:"TO9rPx1abdPe3lllR5Wo3WFrvz8CV9vw",oauth_nonce:l(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:e.name(),location:"Portugal",limit:1},r="8hqIHpplfRBLzs6YOqLZFfkx7jg",s="evb3bjTox8RNlfZ5Ma74hqJjZWo",i=oauthSignature.generate(t,a,o,r,s);o.oauth_signature=i;var n={url:a,data:o,cache:!0,dataType:"jsonp",success:function(e){$("#yelp").attr("src",e.businesses[0].rating_img_url),$("#yelp-url").attr("href",e.businesses[0].url)},error:function(){$("#text").html("Data could not be retrieved from yelp.")}};$.ajax(n)},google.maps.event.addDomListener(window,"load",function(){e.initialize(),e.buildPlaceLocations(),e.setPlaceClickFunctions(),e.filteredPlaceList(e.placeList())})},Place=function(e){"use strict";var t;this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.address=ko.observable(e.address),this.type=ko.observable(e.type),t=new google.maps.Marker({position:new google.maps.LatLng(this.lat(),this.lng()),map:map,title:this.name()}),this.marker=ko.observable(t)};ko.applyBindings(new ViewModel);
